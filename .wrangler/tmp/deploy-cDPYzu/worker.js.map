{
  "version": 3,
  "sources": ["../../../src/worker.js"],
  "sourceRoot": "C:\\Users\\Kyle\\Documents\\GitHub\\siegecmd.net\\.wrangler\\tmp\\deploy-cDPYzu",
  "sourcesContent": ["export default {\n  async fetch(request, env) {\n    const url = new URL(request.url);\n\n    if (url.pathname.startsWith(\"/api/\")) {\n      return handleApi(request, env);\n    }\n\n    if (request.method === \"POST\" && url.pathname === \"/verify\") {\n      return handleTurnstileVerification(request, env);\n    }\n\n    const assetRes = await env.ASSETS.fetch(request);\n    if (assetRes.status !== 404) return assetRes;\n\n    const indexReq = new Request(new URL(\"/\", request.url), request);\n    return env.ASSETS.fetch(indexReq);\n  },\n};\n\nasync function handleApi(request, env) {\n  const url = new URL(request.url);\n\n  if (request.method === \"GET\" && url.pathname === \"/api/typing-words\") {\n    const count = Math.min(\n      parseInt(url.searchParams.get(\"count\") || \"50\", 10),\n      100\n    );\n\n    const raw = await env.TYPING_WORDS.get(\"common_words_v1\");\n    if (!raw)\n      return new Response(\"Missing common_words_v1 in KV\", { status: 500 });\n\n    let list;\n    try {\n      list = JSON.parse(raw.replace(/^\\uFEFF/, \"\"));\n    } catch (e) {\n      return new Response(`Invalid KV JSON: ${e.message}`, { status: 500 });\n    }\n\n    if (!Array.isArray(list) || list.length === 0) {\n      return new Response(\"Invalid KV data\", { status: 500 });\n    }\n\n    const out = [];\n    const picked = new Set();\n    while (out.length < count && picked.size < list.length) {\n      const w = list[Math.floor(Math.random() * list.length)];\n      if (picked.has(w)) continue;\n      picked.add(w);\n      out.push(w);\n    }\n\n    return new Response(JSON.stringify({ words: out }), {\n      headers: {\n        \"content-type\": \"application/json\",\n        \"cache-control\": \"no-store\",\n      },\n    });\n  }\n\n  return new Response(\"Not Found\", { status: 404 });\n}\n\nasync function handleTurnstileVerification(request, env) {\n  const formData = await request.formData();\n  const token = formData.get(\"cf-turnstile-response\");\n  if (!token) return new Response(\"Missing token\", { status: 400 });\n\n  const res = await fetch(\n    \"https://challenges.cloudflare.com/turnstile/v0/siteverify\",\n    {\n      method: \"POST\",\n      body: new URLSearchParams({\n        secret: env.TURNSTILE_SECRET_KEY,\n        response: token,\n        remoteip: request.headers.get(\"CF-Connecting-IP\") || \"\",\n      }),\n      headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n    }\n  );\n\n  const json = await res.json();\n  if (!json.success)\n    return new Response(\"Turnstile verification failed\", { status: 403 });\n\n  return new Response(\"Human verified\", { status: 200 });\n}\n"],
  "mappings": ";;;;AAAA,IAAO,iBAAQ;AAAA,EACb,MAAM,MAAM,SAAS,KAAK;AACxB,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAE/B,QAAI,IAAI,SAAS,WAAW,OAAO,GAAG;AACpC,aAAO,UAAU,SAAS,GAAG;AAAA,IAC/B;AAEA,QAAI,QAAQ,WAAW,UAAU,IAAI,aAAa,WAAW;AAC3D,aAAO,4BAA4B,SAAS,GAAG;AAAA,IACjD;AAEA,UAAM,WAAW,MAAM,IAAI,OAAO,MAAM,OAAO;AAC/C,QAAI,SAAS,WAAW,IAAK,QAAO;AAEpC,UAAM,WAAW,IAAI,QAAQ,IAAI,IAAI,KAAK,QAAQ,GAAG,GAAG,OAAO;AAC/D,WAAO,IAAI,OAAO,MAAM,QAAQ;AAAA,EAClC;AACF;AAEA,eAAe,UAAU,SAAS,KAAK;AACrC,QAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAE/B,MAAI,QAAQ,WAAW,SAAS,IAAI,aAAa,qBAAqB;AACpE,UAAM,QAAQ,KAAK;AAAA,MACjB,SAAS,IAAI,aAAa,IAAI,OAAO,KAAK,MAAM,EAAE;AAAA,MAClD;AAAA,IACF;AAEA,UAAM,MAAM,MAAM,IAAI,aAAa,IAAI,iBAAiB;AACxD,QAAI,CAAC;AACH,aAAO,IAAI,SAAS,iCAAiC,EAAE,QAAQ,IAAI,CAAC;AAEtE,QAAI;AACJ,QAAI;AACF,aAAO,KAAK,MAAM,IAAI,QAAQ,WAAW,EAAE,CAAC;AAAA,IAC9C,SAAS,GAAG;AACV,aAAO,IAAI,SAAS,oBAAoB,EAAE,OAAO,IAAI,EAAE,QAAQ,IAAI,CAAC;AAAA,IACtE;AAEA,QAAI,CAAC,MAAM,QAAQ,IAAI,KAAK,KAAK,WAAW,GAAG;AAC7C,aAAO,IAAI,SAAS,mBAAmB,EAAE,QAAQ,IAAI,CAAC;AAAA,IACxD;AAEA,UAAM,MAAM,CAAC;AACb,UAAM,SAAS,oBAAI,IAAI;AACvB,WAAO,IAAI,SAAS,SAAS,OAAO,OAAO,KAAK,QAAQ;AACtD,YAAM,IAAI,KAAK,KAAK,MAAM,KAAK,OAAO,IAAI,KAAK,MAAM,CAAC;AACtD,UAAI,OAAO,IAAI,CAAC,EAAG;AACnB,aAAO,IAAI,CAAC;AACZ,UAAI,KAAK,CAAC;AAAA,IACZ;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,IAAI,CAAC,GAAG;AAAA,MAClD,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,iBAAiB;AAAA,MACnB;AAAA,IACF,CAAC;AAAA,EACH;AAEA,SAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAClD;AA1Ce;AA4Cf,eAAe,4BAA4B,SAAS,KAAK;AACvD,QAAM,WAAW,MAAM,QAAQ,SAAS;AACxC,QAAM,QAAQ,SAAS,IAAI,uBAAuB;AAClD,MAAI,CAAC,MAAO,QAAO,IAAI,SAAS,iBAAiB,EAAE,QAAQ,IAAI,CAAC;AAEhE,QAAM,MAAM,MAAM;AAAA,IAChB;AAAA,IACA;AAAA,MACE,QAAQ;AAAA,MACR,MAAM,IAAI,gBAAgB;AAAA,QACxB,QAAQ,IAAI;AAAA,QACZ,UAAU;AAAA,QACV,UAAU,QAAQ,QAAQ,IAAI,kBAAkB,KAAK;AAAA,MACvD,CAAC;AAAA,MACD,SAAS,EAAE,gBAAgB,oCAAoC;AAAA,IACjE;AAAA,EACF;AAEA,QAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,MAAI,CAAC,KAAK;AACR,WAAO,IAAI,SAAS,iCAAiC,EAAE,QAAQ,IAAI,CAAC;AAEtE,SAAO,IAAI,SAAS,kBAAkB,EAAE,QAAQ,IAAI,CAAC;AACvD;AAvBe;",
  "names": []
}
